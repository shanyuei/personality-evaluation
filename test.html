<script>
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))

    function check(planName) {
        if ($('#needLoginModal').length > 0) {
            if (!logintoken) {
                $('#needLoginModal').modal('show')
            } else {
                let planSection = $('.' + planName);
                if (planSection.length > 0) {
                    let checkedRadio = planSection.find('input[type="radio"]:checked');
                    if (checkedRadio.length > 0) {

                        let data = checkedRadio.data('json');


                        let payParams = {
                            name: planName,
                            order_price: data.del_price,
                            pay_price: data.price,
                            package_price_id: data.id,
                            pay_type: 6
                        };
                        // if (window.location.href.indexOf('24.222.9.162') > -1) {
                        // 	$.ajax({
                        // 		url: 'https://api.yeespy.com/api/Vip/addToCart',
                        // 		type: 'POST',
                        // 		headers: {
                        // 			'token': logintoken
                        // 		},
                        // 		data: {
                        // 			package_price_id: payParams.package_price_id
                        // 		},
                        // 		success: function(response) {
                        // 			console.log(response);
                        // 			if (window.location.href.indexOf('24.222.9.162') > -1) {
                        // 				window.location.href =
                        // 				'http://124.222.9.162:9090/page/preview/id/2115';
                        // 			} else {
                        // 				window.location.href = './payment.html';
                        // 			}
                        // 		},
                        // 		error: function(xhr, status, error) {
                        // 			console.log('请求失败：', error);
                        // 		}
                        // 	});
                        // } else {
                        $.ajax({
                            url: 'https://api.yeespy.com/api/Vip/createOrder',
                            type: 'POST',
                            headers: {
                                'token': logintoken
                            },
                            data: payParams,
                            success: function (response) {
                                if (response.code === 1) {
                                    console.log('订单创建成功：', response);


                                    window.location.href = './checkout.html?order_sn=' + response.data.order_sn + '&token=' + logintoken;
                                    // if (window.location.href.indexOf('24.222.9.162') > -1) {
                                    //     window.location.href =
                                    //         'http://124.222.9.162:8080/page/preview/id/2097?order_sn=' +
                                    //         response.data.order_sn;
                                    // } else {
                                    //     window.location.href = './payment.html?order_sn=' + response.data
                                    //         .order_sn;
                                    // }
                                } else {
                                    console.log('订单创建失败：', response.message);
                                }
                            },
                            error: function (xhr, status, error) {
                                console.log('请求失败：', error);
                            }
                        });
                        // }



                        console.log('完整数据：', data);
                    } else {
                        console.log('请选择一个套餐选项');
                    }
                }
            }
        }
    }
    $(function () {
        function handleData(data) {
            let num = 0;
            $('.u-row').each((i, item) => {
                let name = $(item).find(".fs-5.fw-700").text();
                $(item).addClass(name);
                data.map((obj, j) => {
                    if (name == obj.name) {
                        console.log(obj.package_prices)
                        $(item).find(".plan-checklist").empty();
                        num++;
                        obj.package_prices.forEach((bd, x) => {
                            let jsonString = JSON.stringify(bd).replace(/"/g, '&quot;');
                            $(item).find(".plan-checklist").append(`<label class="form-check form-check-lg py-2 my-2" for="flexCheckDefault${bd.id}${num}">
                                <input class="form-check-input form-check-input-hook" type="radio" data-mouth="${bd.length}"
                                    data-money="US$" value="${bd.price}/${bd.del_price}" data-buyurl="#flexCheckDefault${bd.id}"
                                    name="flexRadioDefault${num}" id="flexCheckDefault${bd.id}${num}" data-json="${jsonString}">
                                <div class="form-check-label d-flex align-items-center justify-content-between">
                                    <div> ${bd.length}-Month Plan </div>
                                    <div> <b class="fs-6 fw-600">$${bd.price}</b> <del class="text-muted">$${bd.del_price}</del></div>
                                </div>
                            </label>`);
                        });
                        if (name == 'Premium') {
                            $(item).find('input[type="radio"]').eq(2).attr('checked', 'checked');
                        } else {
                            $(item).find('input[type="radio"]').eq(0).attr('checked', 'checked');
                        }
                    }
                });
            });
        }
        let cachedData = localStorage.getItem('packageListData');
        if (cachedData) {
            handleData(JSON.parse(cachedData));
        }
        $.get("https://api.yeespy.com/api/Ability/get_package_list_pc?type=2", function (res) {
            localStorage.setItem('packageListData', JSON.stringify(res.data));
            if (cachedData != JSON.stringify(res.data)) {
                handleData(res.data);
            }
        });

    });
</script>