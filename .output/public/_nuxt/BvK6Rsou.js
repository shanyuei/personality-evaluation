import{aK as J,c as S,aL as p,aM as M,aN as X,aO as Y,aP as Z,I as K,M as tt,x as I,aQ as et,aR as at,r as A,aS as L,at as st,P as nt,aT as rt,y as j,aU as ot,q as z,aV as it,aW as ct,a2 as ut,aX as F,aJ as N,aE as lt}from"./vQvnemwP.js";import{c as dt}from"./DHzwNi16.js";const ft=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],ht=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],yt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",C=[];class _t{_data=new P;_hash=new P([...ft]);_nDataBytes=0;_minBufferSize=0;finalize(t){t&&this._append(t);const s=this._nDataBytes*8,a=this._data.sigBytes*8;return this._data.words[a>>>5]|=128<<24-a%32,this._data.words[(a+64>>>9<<4)+14]=Math.floor(s/4294967296),this._data.words[(a+64>>>9<<4)+15]=s,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}_doProcessBlock(t,s){const a=this._hash.words;let n=a[0],c=a[1],r=a[2],o=a[3],u=a[4],_=a[5],i=a[6],d=a[7];for(let l=0;l<64;l++){if(l<16)C[l]=t[s+l]|0;else{const D=C[l-15],y=(D<<25|D>>>7)^(D<<14|D>>>18)^D>>>3,f=C[l-2],E=(f<<15|f>>>17)^(f<<13|f>>>19)^f>>>10;C[l]=y+C[l-7]+E+C[l-16]}const m=u&_^~u&i,h=n&c^n&r^c&r,g=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),w=(u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25),v=d+w+m+ht[l]+C[l],b=g+h;d=i,i=_,_=u,u=o+v|0,o=r,r=c,c=n,n=v+b|0}a[0]=a[0]+n|0,a[1]=a[1]+c|0,a[2]=a[2]+r|0,a[3]=a[3]+o|0,a[4]=a[4]+u|0,a[5]=a[5]+_|0,a[6]=a[6]+i|0,a[7]=a[7]+d|0}_append(t){typeof t=="string"&&(t=P.fromUtf8(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}_process(t){let s,a=this._data.sigBytes/64;t?a=Math.ceil(a):a=Math.max((a|0)-this._minBufferSize,0);const n=a*16,c=Math.min(n*4,this._data.sigBytes);if(n){for(let r=0;r<n;r+=16)this._doProcessBlock(this._data.words,r);s=this._data.words.splice(0,n),this._data.sigBytes-=c}return new P(s,c)}}class P{words;sigBytes;constructor(t,s){t=this.words=t||[],this.sigBytes=s===void 0?t.length*4:s}static fromUtf8(t){const s=unescape(encodeURIComponent(t)),a=s.length,n=[];for(let c=0;c<a;c++)n[c>>>2]|=(s.charCodeAt(c)&255)<<24-c%4*8;return new P(n,a)}toBase64(){const t=[];for(let s=0;s<this.sigBytes;s+=3){const a=this.words[s>>>2]>>>24-s%4*8&255,n=this.words[s+1>>>2]>>>24-(s+1)%4*8&255,c=this.words[s+2>>>2]>>>24-(s+2)%4*8&255,r=a<<16|n<<8|c;for(let o=0;o<4&&s*8+o*6<this.sigBytes*8;o++)t.push(yt.charAt(r>>>6*(3-o)&63))}return t.join("")}concat(t){if(this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4),this.sigBytes%4)for(let s=0;s<t.sigBytes;s++){const a=t.words[s>>>2]>>>24-s%4*8&255;this.words[this.sigBytes+s>>>2]|=a<<24-(this.sigBytes+s)%4*8}else for(let s=0;s<t.sigBytes;s+=4)this.words[this.sigBytes+s>>>2]=t.words[s>>>2];this.sigBytes+=t.sigBytes}}function gt(e){return new _t().finalize(e).toBase64()}function B(e){return gt(J(e))}const vt={trailing:!0};function mt(e,t=25,s={}){if(s={...vt,...s},!Number.isFinite(t))throw new TypeError("Expected `wait` to be a finite number");let a,n,c=[],r,o;const u=(d,l)=>(r=bt(e,d,l),r.finally(()=>{if(r=null,s.trailing&&o&&!n){const m=u(d,o);return o=null,m}}),r),_=function(...d){return s.trailing&&(o=d),r||new Promise(l=>{const m=!n&&s.leading;clearTimeout(n),n=setTimeout(()=>{n=null;const h=s.leading?a:u(this,d);o=null;for(const g of c)g(h);c=[]},t),m?(a=u(this,d),l(a)):c.push(l)})},i=d=>{d&&(clearTimeout(d),n=null)};return _.isPending=()=>!!n,_.cancel=()=>{i(n),c=[],o=null},_.flush=()=>{if(i(n),!o||r)return;const d=o;return o=null,u(this,d)},_}async function bt(e,t,s){return await e.apply(t,s)}function Dt(...e){const t=typeof e[e.length-1]=="string"?e.pop():void 0;pt(e[0],e[1])&&e.unshift(t);let[s,a,n={}]=e,c=!1;const r=S(()=>p(s));if(typeof r.value!="string")throw new TypeError("[nuxt] [useAsyncData] key must be a string.");if(typeof a!="function")throw new TypeError("[nuxt] [useAsyncData] handler must be a function.");const o=M();n.server??=!0,n.default??=Ct,n.getCachedData??=G,n.lazy??=!1,n.immediate??=!0,n.deep??=X.deep,n.dedupe??="cancel",n._functionName,o._asyncData[r.value];function u(){const h={cause:"initial",dedupe:n.dedupe};return o._asyncData[r.value]?._init||(h.cachedData=n.getCachedData(r.value,o,{cause:"initial"}),o._asyncData[r.value]=q(o,r.value,a,n,h.cachedData)),()=>o._asyncData[r.value].execute(h)}const _=u(),i=o._asyncData[r.value];i._deps++;const d=n.server!==!1&&o.payload.serverRendered;{let h=function(y){const f=o._asyncData[y];f?._deps&&(f._deps--,f._deps===0&&f?._off())};const g=Y();if(g&&d&&n.immediate&&!g.sp&&(g.sp=[]),g&&!g._nuxtOnBeforeMountCbs){g._nuxtOnBeforeMountCbs=[];const y=g._nuxtOnBeforeMountCbs;Z(()=>{y.forEach(f=>{f()}),y.splice(0,y.length)}),K(()=>y.splice(0,y.length))}const w=g&&(g._nuxtClientOnly||tt(dt,!1));d&&o.isHydrating&&(i.error.value||i.data.value!==void 0)?i.status.value=i.error.value?"error":"success":g&&(!w&&o.payload.serverRendered&&o.isHydrating||n.lazy)&&n.immediate?g._nuxtOnBeforeMountCbs.push(_):n.immediate&&i.status.value!=="success"&&_();const v=at(),b=I(r,(y,f)=>{if((y||f)&&y!==f){c=!0;const E=o._asyncData[f]?.data.value!==void 0,R=o._asyncDataPromises[f]!==void 0,T={cause:"initial",dedupe:n.dedupe};if(!o._asyncData[y]?._init){let U;f&&E?U=o._asyncData[f].data.value:(U=n.getCachedData(y,o,{cause:"initial"}),T.cachedData=U),o._asyncData[y]=q(o,y,a,n,U)}o._asyncData[y]._deps++,f&&h(f),(n.immediate||E||R)&&o._asyncData[y].execute(T),ot(()=>{c=!1})}},{flush:"sync"}),D=n.watch?I(n.watch,()=>{c||i._execute({cause:"watch",dedupe:n.dedupe})}):()=>{};v&&et(()=>{b(),D(),h(r.value)})}const l={data:O(()=>o._asyncData[r.value]?.data),pending:O(()=>o._asyncData[r.value]?.pending),status:O(()=>o._asyncData[r.value]?.status),error:O(()=>o._asyncData[r.value]?.error),refresh:(...h)=>o._asyncData[r.value]?._init?o._asyncData[r.value].execute(...h):u()(),execute:(...h)=>l.refresh(...h),clear:()=>{const h=o._asyncData[r.value];if(h?._abortController)try{h._abortController.abort(new DOMException("AsyncData aborted by user.","AbortError"))}finally{h._abortController=void 0}k(o,r.value)}},m=Promise.resolve(o._asyncDataPromises[r.value]).then(()=>l);return Object.assign(m,l),m}function O(e){return S({get(){return e()?.value},set(t){const s=e();s&&(s.value=t)}})}function pt(e,t){return!(typeof e=="string"||typeof e=="object"&&e!==null||typeof e=="function"&&typeof t=="function")}function k(e,t){t in e.payload.data&&(e.payload.data[t]=void 0),t in e.payload._errors&&(e.payload._errors[t]=void 0),e._asyncData[t]&&(e._asyncData[t].data.value=j(e._asyncData[t]._default()),e._asyncData[t].error.value=void 0,e._asyncData[t].status.value="idle"),t in e._asyncDataPromises&&(e._asyncDataPromises[t]=void 0)}function wt(e,t){const s={};for(const a of t)s[a]=e[a];return s}function q(e,t,s,a,n){e.payload._errors[t]??=void 0;const c=a.getCachedData!==G,r=s,o=a.deep?A:L,u=n!==void 0,_=e.hook("app:data:refresh",async d=>{(!d||d.includes(t))&&await i.execute({cause:"refresh:hook"})}),i={data:o(u?n:a.default()),pending:S(()=>i.status.value==="pending"),error:st(e.payload._errors,t),status:L("idle"),execute:(...d)=>{const[l,m=void 0]=d,h=l&&m===void 0&&typeof l=="object"?l:{};if(e._asyncDataPromises[t]&&(h.dedupe??a.dedupe)==="defer")return e._asyncDataPromises[t];{const v="cachedData"in h?h.cachedData:a.getCachedData(t,e,{cause:h.cause??"refresh:manual"});if(v!==void 0)return e.payload.data[t]=i.data.value=v,i.error.value=void 0,i.status.value="success",Promise.resolve(v)}i._abortController&&i._abortController.abort(new DOMException("AsyncData request cancelled by deduplication","AbortError")),i._abortController=new AbortController,i.status.value="pending";const g=new AbortController,w=new Promise((v,b)=>{try{const D=h.timeout??a.timeout,y=Bt([i._abortController?.signal,h?.signal],g.signal,D);if(y.aborted){const f=y.reason;b(f instanceof Error?f:new DOMException(String(f??"Aborted"),"AbortError"));return}return y.addEventListener("abort",()=>{const f=y.reason;b(f instanceof Error?f:new DOMException(String(f??"Aborted"),"AbortError"))},{once:!0,signal:g.signal}),Promise.resolve(r(e,{signal:y})).then(v,b)}catch(D){b(D)}}).then(async v=>{let b=v;a.transform&&(b=await a.transform(v)),a.pick&&(b=wt(b,a.pick)),e.payload.data[t]=b,i.data.value=b,i.error.value=void 0,i.status.value="success"}).catch(v=>{if(!(e._asyncDataPromises[t]&&e._asyncDataPromises[t]!==w)&&!i._abortController?.signal.aborted){if(typeof DOMException<"u"&&v instanceof DOMException&&v.name==="AbortError"){i.status.value="idle";return}i.error.value=rt(v),i.data.value=j(a.default()),i.status.value="error"}}).finally(()=>{g.abort(),delete e._asyncDataPromises[t]});return e._asyncDataPromises[t]=w,e._asyncDataPromises[t]},_execute:mt((...d)=>i.execute(...d),0,{leading:!0}),_default:a.default,_deps:0,_init:!0,_hash:void 0,_off:()=>{_(),e._asyncData[t]?._init&&(e._asyncData[t]._init=!1),c||nt(()=>{e._asyncData[t]?._init||(k(e,t),i.execute=()=>Promise.resolve())})}};return i}const Ct=()=>{},G=(e,t,s)=>{if(t.isHydrating)return t.payload.data[e];if(s.cause!=="refresh:manual"&&s.cause!=="refresh:hook")return t.static.data[e]};function Bt(e,t,s){const a=e.filter(r=>!!r);if(typeof s=="number"&&s>=0){const r=AbortSignal.timeout?.(s);r&&a.push(r)}if(AbortSignal.any)return AbortSignal.any(a);const n=new AbortController;for(const r of a)if(r.aborted){const o=r.reason??new DOMException("Aborted","AbortError");try{n.abort(o)}catch{n.abort()}return n.signal}const c=()=>{const o=a.find(u=>u.aborted)?.reason??new DOMException("Aborted","AbortError");try{n.abort(o)}catch{n.abort()}};for(const r of a)r.addEventListener?.("abort",c,{once:!0,signal:t});return n.signal}function V(e,t,s){const[a={},n]=typeof t=="string"?[{},t]:[t,s],c=S(()=>p(e)),r=S(()=>p(a.key)||"$f"+B([n,typeof c.value=="string"?c.value:"",...Pt(a)]));if(!a.baseURL&&typeof c.value=="string"&&c.value[0]==="/"&&c.value[1]==="/")throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:o,lazy:u,default:_,transform:i,pick:d,watch:l,immediate:m,getCachedData:h,deep:g,dedupe:w,timeout:v,...b}=a,D=z({...it,...b,cache:typeof a.cache=="boolean"?void 0:a.cache}),y={server:o,lazy:u,default:_,transform:i,pick:d,immediate:m,getCachedData:h,deep:g,dedupe:w,timeout:v,watch:l===!1?[]:[...l||[],D]};return Dt(l===!1?r.value:r,(E,{signal:R})=>(a.$fetch||globalThis.$fetch)(c.value,{signal:R,...D}),y)}function Pt(e){const t=[p(e.method)?.toUpperCase()||"GET",p(e.baseURL)];for(const s of[e.query||e.params]){const a=p(s);if(!a)continue;const n={};for(const[c,r]of Object.entries(a))n[p(c)]=p(r);t.push(n)}if(e.body){const s=p(e.body);if(!s)t.push(B(s));else if(s instanceof ArrayBuffer)t.push(B(Object.fromEntries([...new Uint8Array(s).entries()].map(([a,n])=>[a,n.toString()]))));else if(s instanceof FormData){const a={};for(const n of s.entries()){const[c,r]=n;a[c]=r instanceof File?r.name:r}t.push(B(a))}else if(ct(s))t.push(B(z(s)));else try{t.push(B(s))}catch{console.warn("[useFetch] Failed to hash body",s)}}return t}const Et=e=>$("/user/signin",e),St=()=>Q("/user/info"),Ut=e=>$("/user/info_update",e),x=e=>$("/user/pwd_update",e),Ot=()=>Q("/user/personal_info"),Rt=ut("user",()=>{const e=A(),t=u=>new Promise((_,i)=>{Et(u).then(async d=>{const l=F("token"),m=d.data.value;e.value=m.data,l.value=m.data.token,console.log(e.value,l.value),await s(),_(m.data)}).catch(d=>{i(d)})}),s=()=>new Promise((u,_)=>{St().then(i=>{e.value={...i.data.value.data},u(e.value)}).catch(i=>{_(i)})});return{userInfo:e,login:t,logout:()=>{const u=F("token");u.value=null,e.value=void 0,console.log("退出登录")},fetchUserInfo:s,changePassword:u=>x(u),getUserTestInfo:()=>Ot(),updateUserInfo:u=>Ut(u),updatePassword:u=>x(u)}},{persist:{}}),Tt=(e,t)=>{let s=null;if(s=lt(),e.status!==200)throw new Error(e.statusText);const a=e._data.code,n=e._data.message,c=e._data.data;if(a!==0&&s)throw s?.add({title:t.t("common.api.error"),color:"warning",description:n}),new Error(n);e._data={code:a,message:n,data:c}},Ft=e=>{if(e.status!==200)throw new Error(e.statusText)},W=(e,t={})=>{const s=M(),{public:{apiBaseUrl:a}}=N(),n=s.$i18n.locale.value,r=Rt().userInfo,o=F("token");console.log(o.value,r?.token);const u={...t.headers||{},"Accept-Language":n,Lang:n,...o.value||r?.token?{token:`${o.value||r?.token}`}:{}};console.log("headers",u);const _={...t.query||{}};return V(e,{...t,baseURL:a,headers:u,query:_,key:t.key??`api:${e}`,onResponse({response:i}){Tt(i,s.$i18n)}},"$kxxmCqKqLN")},H=(e,t={})=>{const s=M(),{public:{strapiApiUrl:a}}=N(),n=s.$i18n.locale.value,c={...t?.headers||{},"Accept-Language":n},r={...t?.query||{},locale:n};return V(e,{...t,baseURL:a,headers:c,query:r,key:t?.key??`strapi:${e}`,transform:o=>o,onResponse({response:o}){Ft(o)}},"$EtQgCxCyvF")},Q=(e,t,s)=>W(e,{...s,method:"GET",query:t}),$=(e,t,s)=>W(e,{...s,method:"POST",body:t}),It=(e,t)=>H(e,t),Lt=(e,t)=>H(e,{...t,method:"PUT"});export{$ as a,Q as b,It as c,Lt as d,Ot as g,Rt as u};
